<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>WebGPU Explainer</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in Â§N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	html {
		color: black;
		color: var(--text);
		background-color: white;
		background-color: var(--bg);
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		background: transparent top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	 border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd;
	  border: thin solid var(--algo-border);
	  border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: red;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #080;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: none;
		border-bottom: 1px solid #707070;
		border-bottom: 1px solid var(--a-normal-underline);
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		border-bottom-color: #bbb;
		border-bottom-color: var(--a-visited-underline);
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		border-color: #c00;
		border-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker {
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

	@media not print {
		details.annoying-warning[open] {
			position: fixed;
			left: 0;
			right: 0;
			bottom: 2em;
			z-index: 1000;
		}
	}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li .secno { font-size: 85%; }
	.toc > li li li li li { font-size:   85%;    }
	.toc > li li li li li .secno { font-size: 100%; }

	/* @supports not (display:grid) { */
		.toc > li             { margin: 1.5rem 0;    }
		.toc > li li          { margin: 0.3rem 0;    }
		.toc > li li li       { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}

		.toc li {
			clear: both;
		}

		:not(li) > .toc              { margin-left:  5rem; }
		.toc .secno                  { margin-left: -5rem; }
		.toc > li li li .secno       { margin-left: -7rem; }
		.toc > li li li li .secno    { margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc              { margin-left:  4rem; }
			.toc .secno                  { margin-left: -4rem; }
			.toc > li li li              { margin-left:  1rem; }
			.toc > li li li .secno       { margin-left: -5rem; }
			.toc > li li li li .secno    { margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			   comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom: 3px solid #054572;
			border-bottom: 3px solid var(--toclink-underline);
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good table positioning:
		   "content column" is 50ems wide at max; less on smaller screens.
		   Extra space (after ToC + content) is empty on the right.

		   1. When table < content column, centers table in column.
		   2. When content < table < available, left-aligns.
		   3. When table > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version f9f60c8f, updated Fri Sep 25 16:39:03 2020 -0700" name="generator">
  <link href="https://gpuweb.github.io/gpuweb/explainer/" rel="canonical">
  <meta content="7b729db62ee685baa3a5bf480d4addc0d6b77ccc" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "â";
}
.css::after, .property::after, .descriptor::after {
    content: "â";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "â";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "â";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
html {
    color: black;
    color: var(--text);
    background-color: white;
    background-color: var(--bg);
}
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "Â¶"; }
.heading > a.self-link::before { content: "Â§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: #fdf6e3; }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">WebGPU Explainer</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Standard, <time class="dt-updated" datetime="2021-04-08">8 April 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://gpuweb.github.io/gpuweb/explainer/">https://gpuweb.github.io/gpuweb/explainer/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/gpuweb/gpuweb/issues/1321">gpuweb/gpuweb#1321</a>
     <dd><a href="#issues-index">Inline In Spec</a>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> Â© 2021 the Contributors to the WebGPU Explainer Specification, published by the <a href="http://www.w3.org/community/gpu/">GPU for the Web Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   This specification was published by the <a href="https://www.w3.org/community/gpu/">GPU for the Web Community Group</a>.
It is not a W3C Standard nor is it on the W3C Standards Track.

Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. 
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#motivation"><span class="secno">1</span> <span class="content">Motivation</span></a>
    <li><a href="#security"><span class="secno">2</span> <span class="content">Security/Privacy</span></a>
    <li>
     <a href="#background"><span class="secno">3</span> <span class="content">Additional Background</span></a>
     <ol class="toc">
      <li><a href="#gpu-process"><span class="secno">3.1</span> <span class="content">Sandboxed GPU Processes in Web Browsers</span></a>
     </ol>
    <li>
     <a href="#api"><span class="secno">4</span> <span class="content">JavaScript API</span></a>
     <ol class="toc">
      <li><a href="#initialization"><span class="secno">4.1</span> <span class="content">Adapter Selection and Device Init</span></a>
      <li>
       <a href="#invalid-and-destroyed"><span class="secno">4.2</span> <span class="content">Object Validity and Destroyed-ness</span></a>
       <ol class="toc">
        <li>
         <a href="#error-monad"><span class="secno">4.2.1</span> <span class="content">WebGPUâs Error Monad</span></a>
         <ol class="toc">
          <li><a href="#error-monad-mental-model"><span class="secno">4.2.1.1</span> <span class="content">Mental Models</span></a>
         </ol>
        <li><a href="#early-destroy"><span class="secno">4.2.2</span> <span class="content">Early Destruction of WebGPU Objects</span></a>
       </ol>
      <li>
       <a href="#errors"><span class="secno">4.3</span> <span class="content">Errors</span></a>
       <ol class="toc">
        <li>
         <a href="#errors-solutions"><span class="secno">4.3.1</span> <span class="content">Problems and Solutions</span></a>
         <ol class="toc">
          <li><a href="#errors-cases-debugging"><span class="secno">4.3.1.1</span> <span class="content">Debugging</span></a>
          <li><a href="#errors-cases-fatalerrors"><span class="secno">4.3.1.2</span> <span class="content">Fatal Errors: Adapter and Device Loss</span></a>
          <li><a href="#errors-cases-other"><span class="secno">4.3.1.3</span> <span class="content">Fallible Allocation, Fallible Validation, and Telemetry</span></a>
         </ol>
        <li>
         <a href="#errors-errorscopes"><span class="secno">4.3.2</span> <span class="content">Error Scopes</span></a>
         <ol class="toc">
          <li><a href="#errors-errorscopes-allocation"><span class="secno">4.3.2.1</span> <span class="content">How this solves <em>Fallible Allocation</em></span></a>
          <li><a href="#errors-errorscopes-validation"><span class="secno">4.3.2.2</span> <span class="content">How this solves <em>Fallible Validation</em></span></a>
          <li><a href="#errors-errorscopes-telemetry"><span class="secno">4.3.2.3</span> <span class="content">How this solves <em>Telemetry</em></span></a>
          <li><a href="#errors-errorscopes-labels"><span class="secno">4.3.2.4</span> <span class="content">Error Messages and Debug Labels</span></a>
         </ol>
       </ol>
      <li><a href="#device-loss"><span class="secno">4.4</span> <span class="content">Adapter and Device Loss</span></a>
      <li>
       <a href="#buffer-mapping"><span class="secno">4.5</span> <span class="content">Buffer Mapping</span></a>
       <ol class="toc">
        <li><a href="#buffer-mapping-background"><span class="secno">4.5.1</span> <span class="content">Background: Memory Visibility with GPUs and GPU Processes</span></a>
        <li><a href="#buffer-mapping-ownership"><span class="secno">4.5.2</span> <span class="content">CPU-GPU Ownership Transfer</span></a>
        <li><a href="#buffer-mapping-creation"><span class="secno">4.5.3</span> <span class="content">Creation of Mappable Buffers</span></a>
        <li><a href="#buffer-mapping-access"><span class="secno">4.5.4</span> <span class="content">Accessing Mapped Buffers</span></a>
        <li><a href="#buffer-mapping-at-creation"><span class="secno">4.5.5</span> <span class="content">Mapping Buffers at Creation</span></a>
        <li><a href="#buffer-mapping-examples"><span class="secno">4.5.6</span> <span class="content">Examples</span></a>
       </ol>
      <li><a href="#multi-threading"><span class="secno">4.6</span> <span class="content">Multi-Threading</span></a>
      <li><a href="#command-encoding"><span class="secno">4.7</span> <span class="content">Command Encoding and Submission</span></a>
      <li><a href="#pipelines"><span class="secno">4.8</span> <span class="content">Pipelines</span></a>
      <li><a href="#image-input"><span class="secno">4.9</span> <span class="content">Image, Video, and Canvas input</span></a>
      <li><a href="#canvas-output"><span class="secno">4.10</span> <span class="content">Canvas Output</span></a>
      <li><a href="#bitflags"><span class="secno">4.11</span> <span class="content">Bitflags</span></a>
     </ol>
    <li><a href="#wgsl"><span class="secno">5</span> <span class="content">WebGPU Shading Language</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <p class="issue" id="issue-30876714"><a class="self-link" href="#issue-30876714"></a> Set up cross-linking into the WebGPU and WGSL specs. <a href="https://github.com/tabatkins/bikeshed/issues/2006">&lt;https://github.com/tabatkins/bikeshed/issues/2006></a></p>
   <h2 class="heading settled" data-level="1" id="motivation"><span class="secno">1. </span><span class="content">Motivation</span><a class="self-link" href="#motivation"></a></h2>
   <p>See <a href="https://gpuweb.github.io/gpuweb/#introduction">Introduction</a>.</p>
   <h2 class="heading settled" data-level="2" id="security"><span class="secno">2. </span><span class="content">Security/Privacy</span><a class="self-link" href="#security"></a></h2>
   <p>See <a href="https://gpuweb.github.io/gpuweb/#malicious-use">Malicious use considerations</a>.</p>
   <h2 class="heading settled" data-level="3" id="background"><span class="secno">3. </span><span class="content">Additional Background</span><a class="self-link" href="#background"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="gpu-process"><span class="secno">3.1. </span><span class="content">Sandboxed GPU Processes in Web Browsers</span><a class="self-link" href="#gpu-process"></a></h3>
   <p>A major design constraint for WebGPU is that it must be implementable and efficient in browsers that use a GPU-process architecture.
GPU drivers need access to additional kernel syscalls than whatâs otherwise used for Web content, and many GPU drivers are prone to hangs or crashes.
To improve stability and sandboxing, browsers use a special process that contains the GPU driver and talks with the rest of the browser through asynchronous IPC.
GPU processes are (or will be) used in Chromium, Gecko, and WebKit.</p>
   <p>GPU processes are less sandboxed than content processes, and they are typically shared between multiple origins.
Therefore, they must validate all messages, for example to prevent a compromised content process from being able to look at the GPU memory used by another content process.
Most of WebGPUâs validation rules are necessary to ensure it is secure to use, so all the validation needs to happen in the GPU process.</p>
   <p>Likewise, all GPU driver objects only live in the GPU process, including large allocations (like buffers and textures) and complex objects (like pipelines).
In the content process, WebGPU types (<code>GPUBuffer</code>, <code>GPUTexture</code>, <code>GPURenderPipeline</code>, ...) are mostly just "handles" that identify objects that live in the GPU process.
This means that the CPU and GPU memory used by WebGPU object isnât necessarily known in the content process.
A <code>GPUBuffer</code> object can use maybe 150 bytes of CPU memory in the content process but hold a 1GB allocation of GPU memory.</p>
   <p>See also the description of <a href="https://gpuweb.github.io/gpuweb/#programming-model-timelines">the content and device timelines in the specification</a>.</p>
   <h2 class="heading settled" data-level="4" id="api"><span class="secno">4. </span><span class="content">JavaScript API</span><a class="self-link" href="#api"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="initialization"><span class="secno">4.1. </span><span class="content">Adapter Selection and Device Init</span><a class="self-link" href="#initialization"></a></h3>
   <h3 class="heading settled" data-level="4.2" id="invalid-and-destroyed"><span class="secno">4.2. </span><span class="content">Object Validity and Destroyed-ness</span><a class="self-link" href="#invalid-and-destroyed"></a></h3>
   <h4 class="heading settled" data-level="4.2.1" id="error-monad"><span class="secno">4.2.1. </span><span class="content">WebGPUâs Error Monad</span><a class="self-link" href="#error-monad"></a></h4>
   <p>A.k.a. Contagious Internal Nullability.
A.k.a. transparent <a href="http://erights.org/elib/distrib/pipeline.html">promise pipelining</a>.</p>
   <p>WebGPU is a very chatty API, with some applications making tens of thousands of calls per frame to render complex scenes.
We have seen that the GPU processes needs to validate the commands to satisfy their security property.
To avoid the overhead of validating commands twice in both the GPU and content process, WebGPU is designed so Javascript calls can be forwarded directly to the GPU process and validated there.
See the error section for more details on whatâs validated where and how errors are reported.</p>
   <p>At the same time, during a single frame WebGPU objects can be created that depend on one another.
For example a <code>GPUCommandBuffer</code> can be recorded with commands that use temporary <code>GPUBuffer</code>s created in the same frame.
In this example, because of the performance constraint of WebGPU, it is not possible to send the message to create the <code>GPUBuffer</code> to the GPU process and synchronously wait for its processing before continuing Javascript execution.</p>
   <p>Instead, in WebGPU all objects (like <code>GPUBuffer</code>) are created immediately on the content timeline and returned to JavaScript.
The validation is almost all done asynchronously on the "device timeline".
In the good case, when no errors occur (validation or out-of-memory), everything looks to JS as if it is synchronous.
However, when an error occurs in a call, it becomes a no-op (aside from error reporting).
If the call returns an object (like <code>createBuffer</code>), the object is tagged as "invalid" on the GPU process side.</p>
   <p>All WebGPU calls validate that all their arguments are valid objects.
As a result, if a call takes one WebGPU object and returns a new one, the new object is also invalid (hence the term "contagious").</p>
   <figure>
    <figcaption> Timeline diagram of messages passing between processes, demonstrating how errors are propagated without synchronization. </figcaption>
    <object data="img/error_monad_timeline_diagram.svg" type="image/svg+xml"></object>
   </figure>
   <div class="example" id="example-f252e2ff">
    <a class="self-link" href="#example-f252e2ff"></a> Using the API when doing only valid calls looks like a synchronous API: 
<pre class="highlight"><c- kr>const</c-> srcBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    size<c- o>:</c-> <c- mi>4</c-><c- p>,</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->COPY_SRC
<c- p>});</c->

<c- kr>const</c-> dstBuffer <c- o>=</c-> <c- p>...;</c->

<c- kr>const</c-> encoder <c- o>=</c-> device<c- p>.</c->createCommandEncoder<c- p>();</c->
encoder<c- p>.</c->copyBufferToBuffer<c- p>(</c->srcBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> dstBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>4</c-><c- p>);</c->

<c- kr>const</c-> commands <c- o>=</c-> encoder<c- p>.</c->finish<c- p>();</c->
device<c- p>.</c->queue<c- p>.</c->submit<c- p>([</c->commands<c- p>]);</c->
</pre>
   </div>
   <div class="example" id="example-a1bf9afd">
    <a class="self-link" href="#example-a1bf9afd"></a> Errors propagate contagiously when creating objects: 
<pre class="highlight"><c- c1>// The size of the buffer is too big, this causes an OOM and srcBuffer is invalid.</c->
<c- kr>const</c-> srcBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    size<c- o>:</c-> BIG_NUMBER<c- p>,</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->COPY_SRC
<c- p>});</c->

<c- kr>const</c-> dstBuffer <c- o>=</c-> <c- p>...;</c->

<c- c1>// The encoder starts as a valid object.</c->
<c- kr>const</c-> encoder <c- o>=</c-> device<c- p>.</c->createCommandEncoder<c- p>();</c->
<c- c1>// Special case: an invalid object is used when encoding commands so the encoder</c->
<c- c1>// becomes invalid.</c->
encoder<c- p>.</c->copyBufferToBuffer<c- p>(</c->srcBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> dstBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>4</c-><c- p>);</c->

<c- c1>// commands, the this argument to GPUCommandEncoder.finish is invalid</c->
<c- c1>// so the call returns an invalid object.</c->
<c- kr>const</c-> commands <c- o>=</c-> encoder<c- p>.</c->finish<c- p>();</c->
<c- c1>// The command references an invalid object so it becomes a noop.</c->
device<c- p>.</c->queue<c- p>.</c->submit<c- p>([</c->commands<c- p>]);</c->
</pre>
   </div>
   <h5 class="heading settled" data-level="4.2.1.1" id="error-monad-mental-model"><span class="secno">4.2.1.1. </span><span class="content">Mental Models</span><a class="self-link" href="#error-monad-mental-model"></a></h5>
   <p>One way to interpret WebGPUâs semantics is that every WebGPU object is actually a <code>Promise</code> internally and that all WebGPU methods are <code>async</code> and <code>await</code> before using each of the WebGPU objects it gets as argument.
However the execution of the async code is outsourced to the GPU process (where it is actually done synchronously).</p>
   <p>Another way, closer to actual implementation details, is to imagine that each <code>GPUFoo</code> JS object maps to a <code>gpu::InternalFoo</code> C++/Rust object on the GPU process that contains a <code>bool isValid</code>.
Then during the validation of each command on the GPU process, the <code>isValid</code> are all checked and a new, invalid object is returned if validation fails.
On the content process side, the <code>GPUFoo</code> implementation doesnât know if the object is valid or not.</p>
   <h4 class="heading settled" data-level="4.2.2" id="early-destroy"><span class="secno">4.2.2. </span><span class="content">Early Destruction of WebGPU Objects</span><a class="self-link" href="#early-destroy"></a></h4>
   <p>Most of the memory usage of WebGPU objects is in the GPU process: it can be GPU memory held by objects like <code>GPUBuffer</code> and <code>GPUTexture</code>, serialized commands held in CPU memory by <code>GPURenderBundles</code>, or complex object graphs for the WGSL AST in <code>GPUShaderModule</code>.
The JavaScript garbage collector (GC) is in the renderer process and doesnât know about the memory usage in the GPU process.
Browsers have many heuristics to trigger GCs but a common one is that it should be triggered on memory pressure scenarios.
However a single WebGPU object can hold on to MBs or GBs of memory without the GC knowing and never trigger the memory pressure event.</p>
   <p>It is important for WebGPU applications to be able to directly free the memory used by some WebGPU objects without waiting for the GC.
For example applications might create temporary textures and buffers each frame and without the explicit <code>.destroy()</code> call they would quickly run out of GPU memory.
Thatâs why WebGPU has a <code>.destroy()</code> method on those object types which can hold on to arbitrary amount of memory.
It signals that the application doesnât need the content of the object anymore and that it can be freed as soon as possible.
Of course, it becomes a validation to use the object after the call to <code>.destroy()</code>.</p>
   <div class="example" id="example-050ce15f">
    <a class="self-link" href="#example-050ce15f"></a> 
<pre class="highlight"><c- kr>const</c-> dstBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    size<c- o>:</c-> <c- mi>4</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->COPY_DST
<c- p>});</c->

<c- c1>// The buffer is not destroyed (and valid), success!</c->
device<c- p>.</c->queue<c- p>.</c->writeBuffer<c- p>(</c->dstBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> myData<c- p>);</c->

buffer<c- p>.</c->destroy<c- p>();</c->

<c- c1>// The buffer is now destroyed, commands using that would use its</c->
<c- c1>// content produce validation errors.</c->
device<c- p>.</c->queue<c- p>.</c->writeBuffer<c- p>(</c->dstBuffer<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> myData<c- p>);</c->
</pre>
   </div>
   <p>Note that, while this looks somewhat similar to the behavior of an invalid buffer, it is distinct.
Unlike invalidity, destroyed-ness can change after creation, is not contagious, and is validated only when work is actually submitted (e.g. <code>queue.writeBuffer()</code> or <code>queue.submit()</code>), not when creating dependent objects (like command encoders, see above).</p>
   <h3 class="heading settled" data-level="4.3" id="errors"><span class="secno">4.3. </span><span class="content">Errors</span><a class="self-link" href="#errors"></a></h3>
   <p>In a simple world, error handling in apps would be synchronous with JavaScript exceptions.
However, for multi-process WebGPU implementations, this is prohibitively expensive.</p>
   <p>See <a href="#invalid-and-destroyed">Â§â¯4.2 Object Validity and Destroyed-ness</a>, which also explains how the <em>browser</em> handles errors.</p>
   <h4 class="heading settled" data-level="4.3.1" id="errors-solutions"><span class="secno">4.3.1. </span><span class="content">Problems and Solutions</span><a class="self-link" href="#errors-solutions"></a></h4>
   <p>Developers and applications need error handling for a number of cases:</p>
   <ul>
    <li data-md>
     <p><em>Debugging</em>:
Getting errors synchronously during development, to break in to the debugger.</p>
    <li data-md>
     <p><em>Fatal Errors</em>:
Handling device/adapter loss, either by restoring WebGPU or by fallback to non-WebGPU content.</p>
    <li data-md>
     <p><em>Fallible Allocation</em>:
Making fallible GPU-memory resource allocations (detecting out-of-memory conditions).</p>
    <li data-md>
     <p><em>Fallible Validation</em>:
Checking success of WebGPU calls, for applications' unit/integration testing, WebGPU
conformance testing, or detecting errors in data-driven applications (e.g. loading glTF
models that may exceed device limits).</p>
    <li data-md>
     <p><em>Telemetry</em>:
Collecting error logs in deployment, for bug reporting and telemetry.</p>
   </ul>
   <p>The following sections go into more details on these cases and how they are solved.</p>
   <h5 class="heading settled" data-level="4.3.1.1" id="errors-cases-debugging"><span class="secno">4.3.1.1. </span><span class="content">Debugging</span><a class="self-link" href="#errors-cases-debugging"></a></h5>
   <p><strong>Solution:</strong> Dev Tools.</p>
   <p>Implementations should provide a way to enable synchronous validation,
for example via a "break on WebGPU error" option in the developer tools.</p>
   <p>This can be achieved with a content-process-gpu-process round-trip in every validated WebGPU
call, though in practice this would be very slow.
It can be optimized by running a second, approximated mirror of the validation steps in the
content process (it will not always have the same results since it cannot immediately know about
out-of-memory errors).</p>
   <h5 class="heading settled" data-level="4.3.1.2" id="errors-cases-fatalerrors"><span class="secno">4.3.1.2. </span><span class="content">Fatal Errors: Adapter and Device Loss</span><a class="self-link" href="#errors-cases-fatalerrors"></a></h5>
   <p><strong>Solution:</strong> <a href="#device-loss">Â§â¯4.4 Adapter and Device Loss</a>.</p>
   <h5 class="heading settled" data-level="4.3.1.3" id="errors-cases-other"><span class="secno">4.3.1.3. </span><span class="content">Fallible Allocation, Fallible Validation, and Telemetry</span><a class="self-link" href="#errors-cases-other"></a></h5>
   <p><strong>Solution:</strong> <em>Error Scopes</em>.</p>
   <p>For important context, see <a href="#invalid-and-destroyed">Â§â¯4.2 Object Validity and Destroyed-ness</a>. In particular, all errors (validation and
out-of-memory) are detected asynchronously, in a remote process.
In the WebGPU spec, we refer to the thread of work for each WebGPU device as its "device timeline".</p>
   <p>As such, applications need a way to instruct the device timeline on what to do with any errors
that occur. To solve this, WebGPU uses <em>Error Scopes</em>.</p>
   <h4 class="heading settled" data-level="4.3.2" id="errors-errorscopes"><span class="secno">4.3.2. </span><span class="content">Error Scopes</span><a class="self-link" href="#errors-errorscopes"></a></h4>
   <p>WebGL exposed errors using a <code>getError</code> function returning the first error the last <code>getError</code> call.
This is simple, but has two problems.</p>
   <ul>
    <li data-md>
     <p>It is synchronous, incurring a round-trip and requiring all previously issued work to be finished.
We solve this by returning errors asynchronously.</p>
    <li data-md>
     <p>Its flat state model composes poorly: errors can leak to/from unrelated code, possibly in
libraries/middleware, browser extensions, etc. We solve this with a stack of error "scopes",
allowing each component to hermetically capture and handle its own errors.</p>
   </ul>
   <p>Each device<sup>1</sup> maintains a persistent "error scope" stack state.
Initially, the deviceâs error scope stack is empty. <code>GPUDevice.pushErrorScope('validation')</code> or <code>GPUDevice.pushErrorScope('out-of-memory')</code> begins an error scope and pushes it onto the stack.
This scope captures only errors of a particular type depending on the type of error the application
wants to detect.</p>
   <p><code>GPUDevice.popErrorScope()</code> ends an error scope, popping it from the stack and returning a <code>Promise&lt;GPUError?></code>, which resolves once all enclosed fallible operations have completed and
reported back.
It resolves to <code>null</code> if no errors were captured, and otherwise resolves to an object describing
the first error that was captured by the scope - either a <code>GPUValidationError</code> or a <code>GPUOutOfMemoryError</code>.</p>
   <p>Any device-timeline error from an operation is passed to the top-most error scope on the stack at
the time it was issued.</p>
   <ul>
    <li data-md>
     <p>If an error scope captures an error, the error is not passed down the stack.
Each error scope stores only the <strong>first</strong> error it captures; any further errors it captures
are <strong>silently ignored</strong>.</p>
    <li data-md>
     <p>If not, the error is passed down the stack to the enclosing error scope.</p>
    <li data-md>
     <p>If an error reaches the bottom of the stack, it <strong>may</strong><sup>2</sup> fire the <code>uncapturederror</code> event on <code>GPUDevice</code><sup>3</sup> (and could issue a console warning as well).</p>
   </ul>
   <p><sup>1</sup> In the plan to add <a href="#multi-threading">Â§â¯4.6 Multi-Threading</a>, error scope state to actually be <strong>per-device, per-realm</strong>.
That is, when a GPUDevice is posted to a Worker for the first time, the error scope stack for
that device+realm is always empty.
(If a GPUDevice is copied <em>back</em> to an execution context it already existed on, it shares its
error scope state with all other copies on that execution context.)</p>
   <p><sup>2</sup> The implementation may not choose to always fire the event for a given error, for example if it
has fired too many times, too many times rapidly, or with too many errors of the same kind.
This is similar to how Dev Tools console warnings work today for WebGL.
In poorly-formed applications, this mechanism can prevent the events from having a significant
performance impact on the system.</p>
   <p><sup>3</sup> More specifically, with <a href="#multi-threading">Â§â¯4.6 Multi-Threading</a>, this event would only exists on the <em>originating</em> <code>GPUDevice</code> (the one that came from <code>createDevice</code>).
It doesnât exist on <code>GPUDevice</code>s produced by sending messages.</p>
<pre class="language-webidl highlight"><c- b>enum</c-> <c- g>GPUErrorFilter</c-> {
    <c- s>"out-of-memory"</c->,
    <c- s>"validation"</c->
};

<c- b>interface</c-> <c- g>GPUOutOfMemoryError</c-> {
    <c- g>constructor</c->();
};

<c- b>interface</c-> <c- g>GPUValidationError</c-> {
    <c- g>constructor</c->(<c- b>DOMString</c-> <c- g>message</c->);
    <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <c- g>message</c->;
};

<c- b>typedef</c-> (<c- n>GPUOutOfMemoryError</c-> <c- b>or</c-> <c- n>GPUValidationError</c->) <c- g>GPUError</c->;

<c- b>partial</c-> <c- b>interface</c-> <c- g>GPUDevice</c-> {
    <c- b>undefined</c-> <c- g>pushErrorScope</c->(<c- n>GPUErrorFilter</c-> <c- g>filter</c->);
    <c- b>Promise</c->&lt;<c- n>GPUError</c->?> <c- g>popErrorScope</c->();
};
</pre>
   <h5 class="heading settled" data-level="4.3.2.1" id="errors-errorscopes-allocation"><span class="secno">4.3.2.1. </span><span class="content">How this solves <em>Fallible Allocation</em></span><a class="self-link" href="#errors-errorscopes-allocation"></a></h5>
   <p>If a call that fallibly allocates GPU memory (e.g. <code>createBuffer</code> or <code>createTexture</code>) fails, the
resulting object is invalid (same as if there were a validation error), but an <code>'out-of-memory'</code> error is generated.
An <code>'out-of-memory'</code> error scope can be used to detect it.</p>
   <p><strong>Example: tryCreateBuffer</strong></p>
<pre class="language-ts highlight">async <c- a>function</c-> tryCreateBuffer<c- p>(</c->device: <c- b>GPUDevice</c-><c- p>,</c-> descriptor: <c- b>GPUBufferDescriptor</c-><c- p>)</c-><c- o>:</c-> Promise<c- o>&lt;</c->GPUBuffer <c- o>|</c-> <c- kc>null</c-><c- o>></c-> <c- p>{</c->
  device<c- p>.</c->pushErrorScope<c- p>(</c-><c- t>'out-of-memory'</c-><c- p>);</c->
  <c- kr>const</c-> buffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>(</c->descriptor<c- p>);</c->
  <c- k>if</c-> <c- p>(</c->await device<c- p>.</c->popErrorScope<c- p>()</c-> <c- o>!==</c-> <c- kc>null</c-><c- p>)</c-> <c- p>{</c->
    <c- k>return</c-> <c- kc>null</c-><c- p>;</c->
  <c- p>}</c->
  <c- k>return</c-> buffer<c- p>;</c->
<c- p>}</c->
</pre>
   <p>This interacts with buffer mapping in subtle ways, but they are not explained here.
The principle used to design the interaction is that app code should need to handle as few
different edge cases as possible, so multiple kinds of situations should result in the same
behavior.</p>
   <h5 class="heading settled" data-level="4.3.2.2" id="errors-errorscopes-validation"><span class="secno">4.3.2.2. </span><span class="content">How this solves <em>Fallible Validation</em></span><a class="self-link" href="#errors-errorscopes-validation"></a></h5>
   <p>A <code>'validation'</code> error scope can be used to detect validation errors, as above.</p>
   <p><strong>Example: Testing</strong></p>
<pre class="language-ts highlight">device<c- p>.</c->pushErrorScope<c- p>(</c-><c- t>'out-of-memory'</c-><c- p>);</c->
device<c- p>.</c->pushErrorScope<c- p>(</c-><c- t>'validation'</c-><c- p>);</c->

<c- p>{</c->
  <c- c1>// (Do stuff that shouldnât produce errors.)</c->

  <c- p>{</c->
    device<c- p>.</c->pushErrorScope<c- p>(</c-><c- t>'validation'</c-><c- p>);</c->
    device<c- p>.</c->doOperationThatIsExpectedToError<c- p>();</c->
    device<c- p>.</c->popErrorScope<c- p>().</c->then<c- p>(</c->error <c- o>=></c-> <c- p>{</c-> assert<c- p>(</c->error <c- o>!==</c-> <c- kc>null</c-><c- p>);</c-> <c- p>});</c->
  <c- p>}</c->

  <c- c1>// (More stuff that shouldnât produce errors.)</c->
<c- p>}</c->

<c- c1>// Detect unexpected errors.</c->
device<c- p>.</c->popErrorScope<c- p>().</c->then<c- p>(</c->error <c- o>=></c-> <c- p>{</c-> assert<c- p>(</c->error <c- o>===</c-> <c- kc>null</c-><c- p>);</c-> <c- p>});</c->
device<c- p>.</c->popErrorScope<c- p>().</c->then<c- p>(</c->error <c- o>=></c-> <c- p>{</c-> assert<c- p>(</c->error <c- o>===</c-> <c- kc>null</c-><c- p>);</c-> <c- p>});</c->
</pre>
   <h5 class="heading settled" data-level="4.3.2.3" id="errors-errorscopes-telemetry"><span class="secno">4.3.2.3. </span><span class="content">How this solves <em>Telemetry</em></span><a class="self-link" href="#errors-errorscopes-telemetry"></a></h5>
   <p>As mentioned above, if an error is not captured by an error scope, it <strong>may</strong> fire the
originating deviceâs <code>uncapturederror</code> event.
Applications can either watch for that event, or encapsulate parts of their application with
error scopes, to detect errors for generating error reports.</p>
   <p><code>uncapturederror</code> is not strictly necessary to solve this, but has the benefit of providing a
single stream for uncaptured errors from all threads.</p>
   <h5 class="heading settled" data-level="4.3.2.4" id="errors-errorscopes-labels"><span class="secno">4.3.2.4. </span><span class="content">Error Messages and Debug Labels</span><a class="self-link" href="#errors-errorscopes-labels"></a></h5>
   <p>Every WebGPU object has a read-write attribute, <code>label</code>, which can be set by the application to
provide information for debugging tools (error messages, native profilers like Xcode, etc.)
Every WebGPU object creation descriptor has a member <code>label</code> which sets the initial value of the
attribute.</p>
   <p>For both debugging (dev tools messages) and telemetry, implementations can choose to report some
kind of "stack trace" in their error messages, taking advantage of object debug labels.
For example:</p>
<pre>&lt;myQueue>.submit failed:
- commands[0] (&lt;mainColorPass>) was invalid:
- in setIndexBuffer, indexBuffer (&lt;mesh3.indices>) was invalid:
- in createBuffer, desc.usage was invalid (0x89)
</pre>
   <h3 class="heading settled" data-level="4.4" id="device-loss"><span class="secno">4.4. </span><span class="content">Adapter and Device Loss</span><a class="self-link" href="#device-loss"></a></h3>
   <p>Any situation that prevents further use of a <code>GPUDevice</code>, regardless of whether it is caused by a
WebGPU call (e.g. <code>device.destroy()</code>, unrecoverable out-of-memory, GPU process crash, or GPU
reset) or happens externally (e.g. GPU unplugged), results in a device loss.</p>
   <p><strong>Design principle:</strong> There should be as few different-looking error behaviors as possible.
This makes it easier for developers to test their appâs behavior in different situations,
improves robustness of applications in the wild, and improves portability between browsers.</p>
   <p class="issue" id="issue-a7ca2e8b"><a class="self-link" href="#issue-a7ca2e8b"></a> Finish this explainer (see <a href="https://github.com/gpuweb/gpuweb/blob/main/design/ErrorHandling.md#fatal-errors-requestadapter-requestdevice-and-devicelost">ErrorHandling.md</a>).</p>
   <h3 class="heading settled" data-level="4.5" id="buffer-mapping"><span class="secno">4.5. </span><span class="content">Buffer Mapping</span><a class="self-link" href="#buffer-mapping"></a></h3>
   <p>A <code>GPUBuffer</code> represents a memory allocations usable by other GPU operations.
This memory can be accessed linearly, contrary to <code>GPUTexture</code> for which the actual memory layout of sequences of texels are unknown. Think of <code>GPUBuffers</code> as the result of <code>gpu_malloc()</code>.</p>
   <p><strong>CPUâGPU:</strong> When using WebGPU, applications need to transfer data from JavaScript to <code>GPUBuffer</code> very often and potentially in large quantities.
This includes mesh data, drawing and computations parameters, ML model inputs, etc.
Thatâs why an efficient way to update <code>GPUBuffer</code> data is needed. <code>GPUQueue.writeBuffer</code> is reasonably efficient but includes at least an extra copy compared to the buffer mapping used for writing buffers.</p>
   <p><strong>GPUâCPU:</strong> Applications also often need to transfer data from the GPU to Javascript, though usually less often and in lesser quantities.
This includes screenshots, statistics from computations, simulation or ML model results, etc.
This transfer is done with buffer mapping for reading buffers.</p>
   <h4 class="heading settled" data-level="4.5.1" id="buffer-mapping-background"><span class="secno">4.5.1. </span><span class="content">Background: Memory Visibility with GPUs and GPU Processes</span><a class="self-link" href="#buffer-mapping-background"></a></h4>
   <p>The two major types of GPUs are called "integrated GPUs" and "discrete GPUs".
Discrete GPUs are separate from the CPU; they usually come as PCI-e cards that you plug into the motherboard of a computer.
Integrated GPUs live on the same die as the CPU and donât have their own memory chips; instead, they use the same RAM as the CPU.</p>
   <p>When using a discrete GPU, itâs easy to see that most GPU memory allocations arenât visible to the CPU because they are inside the GPUâs RAM (or VRAM for Video RAM).
For integrated GPUs most memory allocations are in the same physical places, but not made visible to the GPU for various reasons (for example, the CPU and GPU can have separate caches for the same memory, so accesses are not cache-coherent).
Instead, for the CPU to see the content of a GPU buffer, it must be "mapped", making it available in the virtual memory space of the application (think of mapped as in <code>mmap()</code>).
GPUBuffers must be specially allocated in order to be mappable - this can make it less efficient to access from the GPU (for example if it needs to be allocate in RAM instead of VRAM).</p>
   <p>All this discussion was centered around native GPU APIs, but in browsers, the GPU driver is loaded in the _GPU process_, so native GPU buffers can be mapped only in the GPU processâs virtual memory.
In general, it is not possible to map the buffer directly inside the _content process_ (though some systems can do this, providing optional optimizations).
To work with this architecture an extra "staging" allocation is needed in shared memory between the GPU process and the content process.</p>
   <p>The table below recapitulates which type of memory is visible where:</p>
   <table class="data">
    <thead>
     <tr>
      <th>
      <th> Regular <code>ArrayBuffer</code> 
      <th> Shared Memory 
      <th> Mappable GPU buffer 
      <th> Non-mappable GPU buffer (or texture) 
    <tbody>
     <tr>
      <td> CPU, in the content process 
      <td> <strong>Visible</strong> 
      <td> <strong>Visible</strong> 
      <td> Not visible 
      <td> Not visible 
     <tr>
      <td> CPU, in the GPU process 
      <td> Not visible 
      <td> <strong>Visible</strong> 
      <td> <strong>Visible</strong> 
      <td> Not visible 
     <tr>
      <td> GPU 
      <td> Not visible 
      <td> Not visible 
      <td> <strong>Visible</strong> 
      <td> <strong>Visible</strong> 
   </table>
   <h4 class="heading settled" data-level="4.5.2" id="buffer-mapping-ownership"><span class="secno">4.5.2. </span><span class="content">CPU-GPU Ownership Transfer</span><a class="self-link" href="#buffer-mapping-ownership"></a></h4>
   <p>In native GPU APIs, when a buffer is mapped, its content becomes accessible to the CPU.
At the same time the GPU can keep using the bufferâs content, which can lead to data races between the CPU and the GPU.
This means that the usage of mapped buffer is simple but leaves the synchronization to the application.</p>
   <p>On the contrary, WebGPU prevents almost all data races in the interest of portability and consistency.
In WebGPU there is even more risk of non-portability with races on mapped buffers because of the additional "shared memory" step that may be necessary on some drivers.
Thatâs why <code>GPUBuffer</code> mapping is done as an ownership transfer between the CPU and the GPU.
At each instant, only one of the two can access it, so no race is possible.</p>
   <p>When an application requests to map a buffer, it initiates a transfer of the bufferâs ownership to the CPU.
At this time, the GPU may still need to finish executing some operations that use the buffer, so the transfer doesnât complete until all previously-enqueued GPU operations are finished.
Thatâs why mapping a buffer is an asynchronous operation (weâll discuss the other arguments below):</p>
<pre class="highlight"><c- b>typedef</c-> [<c- g>EnforceRange</c->] <c- b>unsigned</c-> <c- b>long</c-> <c- g>GPUMapModeFlags</c->;
<c- b>interface</c-> <c- g>GPUMapMode</c-> {
    <c- b>const</c-> <c- n>GPUFlagsConstant</c-> <c- g>READ</c->  = 0x0001;
    <c- b>const</c-> <c- n>GPUFlagsConstant</c-> <c- g>WRITE</c-> = 0x0002;
};

<c- b>partial</c-> <c- b>interface</c-> <c- g>GPUBuffer</c-> {
  <c- b>Promise</c->&lt;<c- b>undefined</c->> <c- g>mapAsync</c->(<c- n>GPUMapModeFlags</c-> <c- g>mode</c->,
                              <c- b>optional</c-> <c- n>GPUSize64</c-> <c- g>offset</c-> = 0,
                              <c- b>optional</c-> <c- n>GPUSize64</c-> <c- g>size</c->);
};
</pre>
   <div class="example" id="example-475276e9">
    <a class="self-link" href="#example-475276e9"></a> Using it is done like so: 
<pre class="highlight"><c- c1>// Mapping a buffer for writing. Here offset and size are defaulted t</c->
<c- c1>// so the whole buffer is mapped.</c->
<c- kr>const</c-> myMapWriteBuffer <c- o>=</c-> <c- p>...;</c->
await myMapWriteBuffer<c- p>.</c->mapAsync<c- p>(</c->GPUMapMode<c- p>.</c->WRITE<c- p>);</c->

<c- c1>// Mapping a buffer for reading. Only the first four bytes are mapped.</c->
<c- kr>const</c-> myMapReadBuffer <c- o>=</c-> <c- p>...;</c->
await myMapReadBuffer<c- p>.</c->mapAsync<c- p>(</c->GPUMapMode<c- p>.</c->READ<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>4</c-><c- p>);</c->
</pre>
   </div>
   <p>Once the application has finished using the buffer on the CPU, it can transfer ownership back to the GPU by unmapping it.
This is an immediate operation that makes the application lose all access to the buffer on the CPU (i.e. detaches <code>ArrayBuffers</code>):</p>
<pre class="highlight"><c- b>partial</c-> <c- b>interface</c-> <c- g>GPUBuffer</c-> {
  <c- b>undefined</c-> <c- g>unmap</c->();
};
</pre>
   <div class="example" id="example-f8e2458b">
    <a class="self-link" href="#example-f8e2458b"></a> Using it is done like so: 
<pre class="highlight"><c- kr>const</c-> myMapReadBuffer <c- o>=</c-> <c- p>...;</c->
await myMapReadBuffer<c- p>.</c->mapAsync<c- p>(</c->GPUMapMode<c- p>.</c->READ<c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>4</c-><c- p>);</c->
<c- c1>// Do something with the mapped buffer.</c->
buffer<c- p>.</c->unmap<c- p>();</c->
</pre>
   </div>
   <p>When transferring ownership to the CPU, a copy may be necessary from the underlying mapped buffer to shared memory visible to the content process.
To avoid copying more than necessary, the application can specify which range it is interested in when calling <code>GPUBuffer.mapAsync</code>.</p>
   <p><code>GPUBuffer.mapAsync</code>'s <code>mode</code> argument controls which type of mapping operation is performed.
At the moment its values are redundant with the buffer creationâs usage flags, but it is present for explicitness and future extensibility.</p>
   <p>While a <code>GPUBuffer</code> is owned by the CPU, it is not possible to submit any operations on the device timeline that use it; otherwise, a validation error is produced.
However it is valid (and encouraged!) to record <code>GPUCommandBuffer</code>s using the <code>GPUBuffer</code>.</p>
   <h4 class="heading settled" data-level="4.5.3" id="buffer-mapping-creation"><span class="secno">4.5.3. </span><span class="content">Creation of Mappable Buffers</span><a class="self-link" href="#buffer-mapping-creation"></a></h4>
   <p>The physical memory location for a <code>GPUBuffer</code>'s underlying buffer depends on whether it should be mappable and whether it is mappable for reading or writing (native APIs give some control on the CPU cache behavior for example).
At the moment mappable buffers can only be used to transfer data (so they can only have the correct <code>COPY_SRC</code> or <code>COPY_DST</code> usage in addition to a <code>MAP_*</code> usage),
Thatâs why applications must specify that buffers are mappable when they are created using the (currently) mutually exclusive <code>GPUBufferUsage.MAP_READ</code> and <code>GPUBufferUsage.MAP_WRITE</code> flags:</p>
   <div class="example" id="example-136b06ef">
    <a class="self-link" href="#example-136b06ef"></a> 
<pre class="highlight"><c- kr>const</c-> myMapReadBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->MAP_READ <c- o>|</c-> GPUBufferUsage<c- p>.</c->COPY_DST<c- p>,</c->
    size<c- o>:</c-> <c- mi>1000</c-><c- p>,</c->
<c- p>});</c->
<c- kr>const</c-> myMapWriteBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->MAP_WRITE <c- o>|</c-> GPUBufferUsage<c- p>.</c->COPY_SRC<c- p>,</c->
    size<c- o>:</c-> <c- mi>1000</c-><c- p>,</c->
<c- p>});</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="4.5.4" id="buffer-mapping-access"><span class="secno">4.5.4. </span><span class="content">Accessing Mapped Buffers</span><a class="self-link" href="#buffer-mapping-access"></a></h4>
   <p>Once a <code>GPUBuffer</code> is mapped, it is possible to access its memory from JavaScript
 This is done by calling <code>GPUBuffer.getMappedRange</code>, which returns an <code>ArrayBuffer</code> called a "mapping".
These are available until <code>GPUBuffer.unmap</code> or <code>GPUBuffer.destroy</code> is called, at which point they are detached.
These <code>ArrayBuffer</code>s typically arenât new allocations, but instead pointers to some kind of shared memory visible to the content process (IPC shared memory, <code>mmap</code>ped file descriptor, etc.)</p>
   <p>When transferring ownership to the GPU, a copy may be necessary from the shared memory to the underlying mapped buffer. <code>GPUBuffer.getMappedRange</code> takes an optional range of the buffer to map (for which <code>offset</code> 0 is the start of the buffer).
This way the browser knows which parts of the underlying <code>GPUBuffer</code> have been "invalidated" and need to be updated from the memory mapping.</p>
   <p>The range must be within the range requested in <code>mapAsync()</code>.</p>
<pre class="highlight"><c- b>partial</c-> <c- b>interface</c-> <c- g>GPUBuffer</c-> {
  <c- b>ArrayBuffer</c-> <c- g>getMappedRange</c->(<c- b>optional</c-> <c- n>GPUSize64</c-> <c- g>offset</c-> = 0,
                             <c- b>optional</c-> <c- n>GPUSize64</c-> <c- g>size</c->);
};
</pre>
   <div class="example" id="example-c7f08ce9">
    <a class="self-link" href="#example-c7f08ce9"></a> Using it is done like so: 
<pre class="highlight"><c- kr>const</c-> myMapReadBuffer <c- o>=</c-> <c- p>...;</c->
await myMapReadBuffer<c- p>.</c->mapAsync<c- p>(</c->GPUMapMode<c- p>.</c->READ<c- p>);</c->
<c- kr>const</c-> data <c- o>=</c-> myMapReadBuffer<c- p>.</c->getMappedRange<c- p>();</c->
<c- c1>// Do something with the data</c->
myMapReadBuffer<c- p>.</c->unmap<c- p>();</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="4.5.5" id="buffer-mapping-at-creation"><span class="secno">4.5.5. </span><span class="content">Mapping Buffers at Creation</span><a class="self-link" href="#buffer-mapping-at-creation"></a></h4>
   <p>A common need is to create a <code>GPUBuffer</code> that is already filled with some data.
This could be achieved by creating a final buffer, then a mappable buffer, filling the mappable buffer, and then copying from the mappable to the final buffer, but this would be inefficient.
Instead this can be done by making the buffer CPU-owned at creation: we call this "mapped at creation".
All buffers can be mapped at creation, even if they donât have the <code>MAP_WRITE</code> buffer usages.
The browser will just handle the transfer of data into the buffer for the application.</p>
   <p>Once a buffer is mapped at creation, it behaves as regularly mapped buffer: <code>GPUBUffer.getMappedRange()</code> is used to retrieve <code>ArrayBuffer</code>s, and ownership is transferred to the GPU with <code>GPUBuffer.unmap()</code>.</p>
   <div class="example" id="example-f0fb4fc7">
    <a class="self-link" href="#example-f0fb4fc7"></a> Mapping at creation is done by passing <code>mappedAtCreation: true</code> in the buffer descriptor on creation: 
<pre class="highlight"><c- kr>const</c-> buffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->UNIFORM<c- p>,</c->
    size<c- o>:</c-> <c- mi>256</c-><c- p>,</c->
    mappedAtCreation<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
<c- p>});</c->
<c- kr>const</c-> data <c- o>=</c-> buffer<c- p>.</c->getMappedRange<c- p>();</c->
<c- c1>// write to data</c->
buffer<c- p>.</c->unmap<c- p>();</c->
</pre>
   </div>
   <p>When using advanced methods to transfer data to the GPU (with a rolling list of buffers that are mapped or being mapped), mapping buffer at creation can be used to immediately create additional space where to put data to be transferred.</p>
   <h4 class="heading settled" data-level="4.5.6" id="buffer-mapping-examples"><span class="secno">4.5.6. </span><span class="content">Examples</span><a class="self-link" href="#buffer-mapping-examples"></a></h4>
   <div class="example" id="example-c2073e23">
    <a class="self-link" href="#example-c2073e23"></a> The optimal way to create a buffer with initial data, for example here a <a href="https://google.github.io/draco/">Draco</a>-compressed 3D mesh: 
<pre class="highlight"><c- kr>const</c-> dracoDecoder <c- o>=</c-> <c- p>...;</c->

<c- kr>const</c-> buffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    usage<c- o>:</c-> GPUBuffer<c- p>.</c->VERTEX <c- o>|</c-> GPUBuffer<c- p>.</c->INDEX<c- p>,</c->
    size<c- o>:</c-> dracoDecoder<c- p>.</c->decompressedSize<c- p>,</c->
    mappedAtCreation<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
<c- p>});</c->

dracoDecoder<c- p>.</c->decodeIn<c- p>(</c->buffer<c- p>.</c->getMappedRange<c- p>());</c->
buffer<c- p>.</c->unmap<c- p>();</c->
</pre>
   </div>
   <div class="example" id="example-5b328714">
    <a class="self-link" href="#example-5b328714"></a> Retrieving data from a texture rendered on the GPU: 
<pre class="highlight"><c- kr>const</c-> texture <c- o>=</c-> getTheRenderedTexture<c- p>();</c->

<c- kr>const</c-> readbackBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
    usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->COPY_DST <c- o>|</c-> GPUBufferUsage<c- p>.</c->MAP_READ<c- p>,</c->
    size<c- o>:</c-> <c- mi>4</c-> <c- o>*</c-> textureWidth <c- o>*</c-> textureHeight<c- p>,</c->
<c- p>});</c->

<c- c1>// Copy data from the texture to the buffer.</c->
<c- kr>const</c-> encoder <c- o>=</c-> device<c- p>.</c->createCommandEncoder<c- p>();</c->
encoder<c- p>.</c->copyTextureToBuffer<c- p>(</c->
    <c- p>{</c-> texture <c- p>},</c->
    <c- p>{</c-> buffer<c- p>,</c-> rowPitch<c- o>:</c-> textureWidth <c- o>*</c-> <c- mi>4</c-> <c- p>},</c->
    <c- p>[</c->textureWidth<c- p>,</c-> textureHeight<c- p>],</c->
<c- p>);</c->
device<c- p>.</c->submit<c- p>([</c->encoder<c- p>.</c->finish<c- p>()]);</c->

<c- c1>// Get the data on the CPU.</c->
await buffer<c- p>.</c->mapAsync<c- p>(</c->GPUMapMode<c- p>.</c->READ<c- p>);</c->
saveScreenshot<c- p>(</c->buffer<c- p>.</c->getMappedRange<c- p>());</c->
buffer<c- p>.</c->unmap<c- p>();</c->
</pre>
   </div>
   <div class="example" id="example-f23f26f7">
    <a class="self-link" href="#example-f23f26f7"></a> Updating a bunch of data on the GPU for a frame: 
<pre class="highlight"><c- k>void</c-> frame<c- p>()</c-> <c- p>{</c->
    <c- c1>// Create a new buffer for our updates. In practice we would</c->
    <c- c1>// reuse buffers from frame to frame by re-mapping them.</c->
    <c- kr>const</c-> stagingBuffer <c- o>=</c-> device<c- p>.</c->createBuffer<c- p>({</c->
        usage<c- o>:</c-> GPUBufferUsage<c- p>.</c->MAP_WRITE <c- o>|</c-> GPUBufferUsage<c- p>.</c->COPY_SRC<c- p>,</c->
        size<c- o>:</c-> <c- mi>16</c-> <c- o>*</c-> objectCount<c- p>,</c->
        mappedAtCreation<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
    <c- p>});</c->
    <c- kr>const</c-> stagingData <c- o>=</c-> <c- k>new</c-> Float32Array<c- p>(</c->stagingBuffer<c- p>.</c->getMappedRange<c- p>());</c->

    <c- c1>// For each draw we are going to:</c->
    <c- c1>//  - Put the data for the draw in stagingData.</c->
    <c- c1>//  - Record a copy from the stagingData to the uniform buffer for the draw</c->
    <c- c1>//  - Encoder the draw</c->
    <c- kr>const</c-> copyEncoder <c- o>=</c-> device<c- p>.</c->createCommandEncoder<c- p>();</c->
    <c- kr>const</c-> drawEncoder <c- o>=</c-> device<c- p>.</c->createCommandEncoder<c- p>();</c->
    <c- kr>const</c-> renderPass <c- o>=</c-> myCreateRenderPass<c- p>(</c->drawEncoder<c- p>);</c->
    <c- k>for</c-> <c- p>(</c-><c- a>var</c-> i <c- o>=</c-> <c- mi>0</c-><c- p>;</c-> i <c- o>&lt;</c-> objectCount<c- p>;</c-> i<c- o>++</c-><c- p>)</c-> <c- p>{</c->
        stagingData<c- p>[</c->i <c- o>*</c-> <c- mi>4</c-> <c- o>+</c-> <c- mi>0</c-><c- p>]</c-> <c- o>=</c-> <c- p>...;</c->
        stagingData<c- p>[</c->i <c- o>*</c-> <c- mi>4</c-> <c- o>+</c-> <c- mi>1</c-><c- p>]</c-> <c- o>=</c-> <c- p>...;</c->
        stagingData<c- p>[</c->i <c- o>*</c-> <c- mi>4</c-> <c- o>+</c-> <c- mi>2</c-><c- p>]</c-> <c- o>=</c-> <c- p>...;</c->
        stagingData<c- p>[</c->i <c- o>*</c-> <c- mi>4</c-> <c- o>+</c-> <c- mi>3</c-><c- p>]</c-> <c- o>=</c-> <c- p>...;</c->

        <c- kr>const</c-> <c- p>{</c->uniformBuffer<c- p>,</c-> uniformOffset<c- p>}</c-> <c- o>=</c-> getUniformsForDraw<c- p>(</c->i<c- p>);</c->
        copyEncoder<c- p>.</c->copyBufferToBuffer<c- p>(</c->
            stagingData<c- p>,</c-> i <c- o>*</c-> <c- mi>16</c-><c- p>,</c->
            uniformBuffer<c- p>,</c-> uniformOffset<c- p>,</c->
            <c- mi>16</c-><c- p>);</c->

        encodeDraw<c- p>(</c->renderPass<c- p>,</c-> <c- p>{</c->uniformBuffer<c- p>,</c-> uniformOffset<c- p>});</c->
    <c- p>}</c->
    renderPass<c- p>.</c->endPass<c- p>();</c->

    <c- c1>// We are finished filling the staging buffer, unmap() it so</c->
    <c- c1>// we can submit commands that use it.</c->
    stagingBuffer<c- p>.</c->unmap<c- p>();</c->

    <c- c1>// Submit all the copies and then all the draws. The copies</c->
    <c- c1>// will happen before the draw such that each draw will use</c->
    <c- c1>// the data that was filled inside the for-loop above.</c->
    device<c- p>.</c->queue<c- p>.</c->submit<c- p>([</c->
        copyEncoder<c- p>.</c->finish<c- p>(),</c->
        drawEncoder<c- p>.</c->finish<c- p>()</c->
    <c- p>]);</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="4.6" id="multi-threading"><span class="secno">4.6. </span><span class="content">Multi-Threading</span><a class="self-link" href="#multi-threading"></a></h3>
   <h3 class="heading settled" data-level="4.7" id="command-encoding"><span class="secno">4.7. </span><span class="content">Command Encoding and Submission</span><a class="self-link" href="#command-encoding"></a></h3>
   <h3 class="heading settled" data-level="4.8" id="pipelines"><span class="secno">4.8. </span><span class="content">Pipelines</span><a class="self-link" href="#pipelines"></a></h3>
   <h3 class="heading settled" data-level="4.9" id="image-input"><span class="secno">4.9. </span><span class="content">Image, Video, and Canvas input</span><a class="self-link" href="#image-input"></a></h3>
   <h3 class="heading settled" data-level="4.10" id="canvas-output"><span class="secno">4.10. </span><span class="content">Canvas Output</span><a class="self-link" href="#canvas-output"></a></h3>
   <h3 class="heading settled" data-level="4.11" id="bitflags"><span class="secno">4.11. </span><span class="content">Bitflags</span><a class="self-link" href="#bitflags"></a></h3>
   <h2 class="heading settled" data-level="5" id="wgsl"><span class="secno">5. </span><span class="content">WebGPU Shading Language</span><a class="self-link" href="#wgsl"></a></h2>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words âMUSTâ, âMUST NOTâ, âREQUIREDâ, âSHALLâ, âSHALL NOTâ, âSHOULDâ, âSHOULD NOTâ, âRECOMMENDEDâ, âMAYâ, and âOPTIONALâ
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words âfor exampleâ
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word âNoteâ
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">â</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">â</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">â</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Donât scroll to compensate for the ToC if weâre above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I donât know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldnât exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isnât standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we donât have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While weâre at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Canât find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Set up cross-linking into the WebGPU and WGSL specs. <a href="https://github.com/tabatkins/bikeshed/issues/2006">&lt;https://github.com/tabatkins/bikeshed/issues/2006></a><a href="#issue-30876714"> âµ </a></div>
   <div class="issue"> Finish this explainer (see <a href="https://github.com/gpuweb/gpuweb/blob/main/design/ErrorHandling.md#fatal-errors-requestadapter-requestdevice-and-devicelost">ErrorHandling.md</a>).<a href="#issue-a7ca2e8b"> âµ </a></div>
  </div>